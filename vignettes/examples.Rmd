---
title: "modCathRes: Examples"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{examples}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(modelCathRes)
```

# Get test data

```{r plotCathodeResistance, include=TRUE}
data("resCathData")
d <- resCathData
head(d)
```

# Log model for cathode resistance

```{r lmModel, include=TRUE}
funLog <- modelCathRes::findLogFunction(d, agebsq, rucv)
# log fit curve
curve <-  ggplot2::stat_function(xlim = c(min(d$agebsq),
                                  max(d$agebsq)),
                         fun = funLog,
                         color = "darkred",
                         size = 1.2) 
ggplot2::ggplot(d, ggplot2::aes(x = agebsq, y = rucv)) +
  ggplot2::geom_point(shape = 21, fill = NA, size = .9, alpha = .5) +
  ggplot2::coord_cartesian(ylim = c(.4, 1.0)) +
  curve
```
# View cathode resistance and model for each pot

```{r plotCathRes, include=TRUE, fig.dim=c(8, 12)}
modelCathRes::plotCathRes(d, cod_cuve, agebsq, rucv, ncol = 4) +
  ggplot2::labs(title = "Evolution of Cathode Resistance per pot") +
  ggplot2::coord_cartesian(ylim = c(.5, 1.0)) +
  curve
```

# Comparing cathode resistance between 2 groups assuming same slope

```{r}
# Creating 2 groups in d
d <-  d %>% 
  mutate(group = ifelse(cod_cuve %in%  c("G148", "G110", "G096"), "GroupA", "GroupB"))
nGroups <- length(unique(d$group))
form <- as.formula("rucv ~ group + log(agebsq) - 1")

mod <- lm(formula = form, 
   data = d)
summary(mod)$coefficients[2]
```


